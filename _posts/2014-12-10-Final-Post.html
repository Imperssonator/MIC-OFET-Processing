---
# Content at the top of these posts are called YAML Front Matter.
# YAML Front Matter and variable-like values that can easily used inside the
# page content later on.  Control expressions like ``for`` & ``if`` can be used also.

# layout is a required variable
# post corresponds to ``_includes/post.html`` which is a template to interpret the
# of the post in this file
layout: post
# title of your post
title:  "Quantifying the Structure-Property Relationship in P3HT thin film transistors"
# the author of the post's github user name
author: dnazarian 
# Data and time of the post
date:   2014-12-10 

# Optional fields
categories:
tags: 

# Refences

---

#Motivation 

![organic electronic devices](https://farm8.staticflickr.com/7462/15990131431_f2e486124c_o.jpg)

In order to reliably fabricate organic electronic devices, we must understand the quantitative relationship between their structure and their electronic properties. One widely studied system is that of poly-3-hexylthiophene (P3HT), a solution-processable polymeric semiconductor, and its charge carrier mobility in field effect transistors.

P3HT has a backbone with good hole conductor properties and side chains at hat make it soluble in organic solvents. 

![P3HT](https://farm8.staticflickr.com/7520/15806386447_0f89739507_b.jpg)

The crystal structure of P3HT has been thoroughly established in the extensive literature on the material:

![structure of P3HT](https://camo.githubusercontent.com/8bbe7e79209299f72e536e703d5bbd36d8425661/68747470733a2f2f6c68362e676f6f676c6575736572636f6e74656e742e636f6d2f2d315f5071463873652d71412f56416141704431344568492f41414141414141414159492f566c492d556a5276796d772f77313537362d683335362d6e6f2f5069253242537461636b253242616e6425324265646765253341666163652e6a7067)

(a) (1 0 0) direction: alkyl stacking; (0 1 0): pi-stacking; (0 0 1): chain backbone (b) Face-on orientation, (c) edge-on orientation

Molecular Dynamics Simulations depict the ideal alkyl and pi-stacking conformations. Charge transport is fastest along the extended chain backbone (0 0 1) and pi-stacked directions (0 1 0). It is almost negligible in the alkyl stacking direction. However, the measured hole mobility of a macro-scale film is orders of magnitude lower than that of the crystalline state.

![stacking](https://farm9.staticflickr.com/8587/15992779985_305e514d09_b.jpg)

P3HT forms nanofibers during processing whose lengths correspond to the (0 1 0)/pi-stacking direction. The nanofibers are apparent the solid state in the Atomic Force Microscopy (AFM) images:

![fibers](https://farm8.staticflickr.com/7476/15992779925_637ea620f4_b.jpg)


#Goal

Our goal is to quantify the structure at top layer of the P3HT thin films, as represented by AFM images and to construct structure-property relationship µ = f(microstructure), where µ is electron hole mobility. 

![function](https://farm8.staticflickr.com/7570/15967017196_7327903159_o.png)

#Data 

[The Reichmanis Group](http://reichmanis.chbe.gatech.edu/research.html) in ChBE performs studies on P3HT structure evolution during processing. They have a substantial collection of Atomic Force Microscopy (AFM) data paired with field-effect mobility measurements for P3HT thin film at a wide range of processing conditions.
Twenty such AFM images and their paired mobility will be used for this study. 

![data](https://lh3.googleusercontent.com/-XLh4YvT_WaQ/VAaAmALDQUI/AAAAAAAAAX4/BuzdJgYV6EI/w2228-h1188-no/Figure%2B2b.jpg)

#Approach

Simply by inspection, we can choose to regress against average fiber length and obtain a fit with a 2nd order polynomial.(Detailed for obtained the fiber lengths will be discussed in more detail in the method section) 

![fiber length fit](https://farm8.staticflickr.com/7549/15967017276_520c3dc972_o.png)

However, many more potentially important features exist:
	- Orientation
	- Area fraction
	- Fiber density

Therefore we needed a systematic method of selecting the most relevant features. To do this we: 
1. Compute spatial statistics for each image in a dataset. Spatial statistics exhaustively generates a vector of microstructural features
2. Perform dimensionality reduction to determine the most informative spatial statistics. Dimensionality reduction was done with Principal component analysis (PCA) which determines linear combinations of spatial statistics that capture the most morphological variation.

It is suspected based on literature that the microstates should identify whether a local state is amorphous or a fiber and if a fiber, it should identify the orientations of fiber. 
Therefore, to perform spatial statistics for each image we must first develop a method to identify fibers and their orientation. 
This can be done through image segmentation

#Image Segmentation 

##Single Value Threshold Based Visual Inspection 
In our first attempt at image segmentation, we applied a single threshold to greyscale of AFM images. The value for this threshold was chosen based on a guess and check by visual inspection. This game a rough distinction between fibular and amorphous regions. 
We then performed spatial statistics on the black and white segmented images and validated our understanding of the spatial statistics algorithm provided to the class by Tony Fast. 
Details about this initial investigation can be followed at the [Spatial Statistics Post](http://imperssonator.github.io/MIC-OFET-Processing/2014/09/29/Spatial-Statistics.html) 

This method was not ideal because it left room for human error and was not an efficeint method for a large dataset. 

##Single Value Threshold Based on Derivative of Number of Connected Components. 
In our second attempt at image segmentation, we developed a method to systematically choose an optimal threshold value. The algorithm applied a wide range of threshold values to a single AFM images and for each threshold image, computed the number of connected components (connected components representing individual fibers). As the threshold value was increased, if the number of connected components plateaued, the threshold value corresponding to the plateau was chosen. 
The following image shows a brief example of our work.

![Thresholding](https://farm6.staticflickr.com/5616/15408121609_eece533bef_b.jpg)
For details on the algorithm, see the [Thresholding Post](http://imperssonator.github.io/MIC-OFET-Processing/2014/10/08/Thresholding.html). 

Although an improvment on the first thresholding effort, this algorithm still used a single threshold value for each image. A single value threshold method fails because the pixle intensities associated with a fiber vary even across single AFM image.  

##Determining Fiber Orientaion 
[regionprops](http://www.mathworks.com/help/images/ref/regionprops.html#bqkf8ik) was used to fit an ellipse to each connected component obtained from the previous thresholding to determine the orientation of that fiber.
To see a proof of concept for this method visit the [Fiber Orientation Post](http://imperssonator.github.io/MIC-OFET-Processing/2014/10/21/Fiber-orientation.html)

Overlapping fiber, especially those in completely different directions will contaminate the orientation calculation. The image below shows a case where the ellipse fit to the connected component in green will chose the green vector to calculate the orientation of the fiber. This orientation is incorrect for both fibers.

![orientation issue](https://farm6.staticflickr.com/5609/14974332554_0d084b46e6_o.png)

Is issue is primarily caussed by insuffient thresholding. Attempts were made to separate such connected fiber using tools like [erode](http://www.mathworks.com/help/images/ref/imerode.html) in matlab. We also attempted to identify orientation despite the connectivity using [hough transformations](http://matlab.izmiran.ru/help/toolbox/images/enhanc11.html).Both attempts were unsucsesful.

##Orientation Informed Fiber Identification 
The final and most successful attempt at image segmentation combined all lessons learned from previous attempts. 
The algorithm involves applying a range of threshold values to a single image. For each thresholded image, two matrices were calculated. The values in the matracies corescpond to pixles in the image.
The first matrix identified the oreintation of the fibers. The second matrix identified the condifence with which the orientations belong to a fibular region. 
To calculate these matracies, for each pixle, if the pixle was apart of a connected component, regionprops was used to fit an ellipse to the connected component. The vector associated with the major axis of the elipise was used to determine orientation. The eccentricity of the ellipse, defined as the ratio of the major axis to the minor axis, to determine the extent to which the region was fiberlike. The higher the ecentricity, the more likely that the region was a fiber. 
This portion of the algorithm is summerized in the figures below.
![orientation algo1](https://farm8.staticflickr.com/7564/15805516720_d517bdaf26_b.jpg)
![orientation algo2](https://farm8.staticflickr.com/7541/15990800091_a4ca49f3c9_b.jpg)

Next the algorithm finds the maximum confidence across all thresholds and takes their corresponding angles.

![max confidence](https://farm8.staticflickr.com/7517/15805399128_8e8dc63f79_b.jpg)

This algorithm allows us to identify individual fibers ans their their corresponding orientation as shown below:
![orientation](https://farm8.staticflickr.com/7517/15994700255_6e68515511_b.jpg)
Here the dark blue represents the amorphous phase. 

The algorithm works even for excessivly noisy images such as:
![noisy ex](https://farm8.staticflickr.com/7504/15808990007_3217c39141_b.jpg)

The final result can be used to determine usefull features of the microstructure such as average fiber length. 
Other informative insights can be gained from visulization of fiber orientation. For example, the image below shows that fibers tend to form in clumps of 3 or four and have long range order.
![clumping img](https://farm8.staticflickr.com/7533/15992780165_8137b9e2fd_b.jpg)

More details about the algorith can be found at its [original post](http://imperssonator.github.io/MIC-OFET-Processing/2014/11/12/Orientation.html).

#Spatial Statistics 





